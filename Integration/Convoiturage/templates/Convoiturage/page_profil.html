{# myapp/templates/myapp/profile.html #}
{% extends 'base.html' %}
{% load static %}

{% block title %}Mon Profil Utilisateur - Covoiturage{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'Convoiturage/css/style_profil.css' %}">
{% endblock %}

{% block content %}
    <div class="container">
        <div class="sidebar">
            <div class="profile-container">
                <input type="file" id="id_profile_picture" name="{{ form.profile_picture.name }}" accept="image/*" style="display: none;" onchange="handleProfilePictureChange(event)">
                <div class="profile-picture" onclick="document.getElementById('id_profile_picture').click()">
                    <img id="avatar" src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}{% static 'ressources/img/profil.jpg' %}{% endif %}" alt="Photo de profil">
                </div>
                <div class="user-info">
                    <h3>{{ user.get_full_name|default:user.username }}</h3>
                    <p>{{ user.email }}</p>
                    <p>{{ user.num_tel|default:"Non spécifié" }}</p>
                </div>
            </div>

            <div class="nav">
                {# Pour le profil, la navigation latérale est une convention. #}
                {# Ces boutons pourraient devenir des liens si vous avez plusieurs sous-sections dans le profil #}
                <button class="active">Informations Personnelles</button>
                {# <button>Sécurité</button> #}
                {# <button>Préférences</button> #}
            </div>
        </div>

        <div class="profile-form">
            <h2>Modifier Mon Profil</h2>

            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}

                {# Messages d'erreur globaux du formulaire #}
                {% if form.non_field_errors %}
                    <ul class="errorlist">
                        {% for error in form.non_field_errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}

                <div class="form-grid">
                    <div>
                        <label for="{{ form.first_name.id_for_label }}">Prénoms</label>
                        {{ form.first_name }}
                        {% if form.first_name.errors %}<ul class="errorlist">{% for error in form.first_name.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                    </div>
                    <div>
                        <label for="{{ form.last_name.id_for_label }}">Nom</label>
                        {{ form.last_name }}
                        {% if form.last_name.errors %}<ul class="errorlist">{% for error in form.last_name.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                    </div>
                    <div class="full-width">
                        <label for="{{ form.email.id_for_label }}">Email</label>
                        {{ form.email }}
                        {% if form.email.errors %}<ul class="errorlist">{% for error in form.email.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                    </div>
                    <div class="full-width">
                        <label for="{{ form.num_tel.id_for_label }}">Numéro de Téléphone</label>
                        {{ form.num_tel }}
                        {% if form.num_tel.errors %}<ul class="errorlist">{% for error in form.num_tel.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                    </div>
                </div>

                <div class="toggle-container">
                    <span class="label">Statut Conducteur :</span>
                    <label class="switch">
                        {{ form.is_conducteur }} {# Ceci est la checkbox générée par Django avec l'ID 'id_is_conducteur' #}
                        <span class="slider round"></span>
                    </label>
                </div>

                {# Section des informations de véhicule (visible/cachée par JS) #}
                <div class="vehicle-info-section">
                    <h3>Informations sur le Véhicule</h3>
                    <div>
                        <label for="{{ form.type_vehicule.id_for_label }}">Type d'engin</label>
                        {{ form.type_vehicule }}
                        {% if form.type_vehicule.errors %}<ul class="errorlist">{% for error in form.type_vehicule.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                    </div>
                    <div>
                        <label for="{{ form.matricule.id_for_label }}">Matricule</label>
                        {{ form.matricule }}
                        {% if form.matricule.errors %}<ul class="errorlist">{% for error in form.matricule.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                    </div>
                    <div class="full-width">
                        <label for="{{ form.position.id_for_label }}">Position (Point de départ préféré)</label>
                        {{ form.position }}
                        {% if form.position.errors %}<ul class="errorlist">{% for error in form.position.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                    </div>
                </div>

                <div class="buttons">
                    <button type="submit" class="save">Sauvegarder</button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script src="{% static 'js/profil.js' %}"></script>
{% endblock %}